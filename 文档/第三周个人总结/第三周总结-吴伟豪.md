# 第三周总结-吴伟豪

> 本周是我们项目的编码阶段，我负责的工作是将通过openMMD或者vnect导出的中间动作文件（json文件）转化为可以在MMD上可以套在人物模型上的动作文件（vmd文件）。

在上周对vmd文件存储格式有了了解后，本周我尝试了将预定的数据写到vmd文件中的工作，即在MMD中设定一个人物动作，记录好相应的骨骼点的旋转角度，然后尝试将特定的数据写入vmd文件中以达到在MMD中重现该动作的目的。然而这项工作远没有想象中的简单，遇到的主要困难有：

##### 1. 在Unicode/GB2312的编码环境下在vmd中写入特定的日文编码

由于MMD是通过将vmd中骨骼关键帧记录中的骨骼名字来与人物模型的骨骼名字来进行关键帧记录的绑定，而目前我们能找到的大部分人物模型的骨骼名称都是日文编码，并且MMD对骨骼名字的识别也是在shift-JIS（日文编码）下识别，所以我们需要在vmd中写入相应骨骼名字的日文编码以保证关键帧数据的准确绑定。

把编译器的编码格式改为shift-JIS，可以直接把日文对应的编码写入vmd中，但出于整个项目编码统一性的考虑，我需要做到在Unicode或者GB2312下实现骨骼名称的正确写入。在做了诸多尝试后，最终的解决方案是，先在shift-JIS下把所有的骨骼名称写到二进制文件中，然后通过UltraEdit打开该二进制文件，找到并记录骨骼名称的日文编码对应的十六进制数据，这样觉得到了需要的骨骼点的在shift-JIS下的编码，然后在Unicode或GB2312中直接写入骨骼对应的十六进制数据即可。

##### 2. MMD中的坐标系

首先MMD中的坐标系是左手坐标系，而我们使用的Qt的qquaternion库来进行四元数的计算时使用的右手坐标系，这里需要左右手坐标系的转换。但是这一点并不容易发现，因为在MMD中对骨骼点的旋转欧拉角的显示在X轴是左手系的旋转角度，在Y和Z轴显示的是右手系的旋转角度，即虽然MMD在计算人物的角度时统一是在左手坐标系下进行计算，但在界面显示旋转角度时只有X轴的旋转角度是左手系下的旋转角度，在没有意识到这一点之前，我一度以为MMD中的坐标系是世界上的第三种坐标系- -